---
title: "Plot_Visuals"
author: "Sai"
date: "`r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r,warning=FALSE,message=FALSE}
library(tidyverse)
library(ranger)
```

```{r,warning=FALSE,message=FALSE}
crime <- read_csv("./data/crime_sample.csv")
```

```{r,warning=FALSE,message=FALSE}
crime <- crime %>%
  mutate(
    highest_offense_description = as.factor(highest_offense_description),
    highest_offense_code           = as.factor(highest_offense_code),
    family_violence                = as.factor(family_violence),
    occurred_date_time_month       = as.ordered(occurred_date_time_month),
    occurred_date_time_day_of_week = as.ordered(occurred_date_time_day_of_week),
    location_type                  = as.factor(location_type),
    apd_sector                     = as.factor(apd_sector),
    apd_district                   = as.factor(apd_district)
  )

crime
```

# Counts of Crimes according to top-8 crime types. 

```{r,warning=FALSE,message=FALSE}
# compute top 8 offenses
top_offenses <- crime %>%
  count(highest_offense_description, sort = TRUE) %>%
  slice_head(n = 8)

# plot
ggplot(top_offenses, aes(
    x = fct_reorder(highest_offense_description, n),
    y = n
  )) +
  geom_col(fill = "#2C3E50") +
  geom_text(aes(label = n), 
            vjust = -0.5, 
            size = 3.5) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
  labs(
    x       = "Highest Offense Description",
    y       = NULL,
  ) +
  theme_minimal() +
  theme(
    axis.ticks.y        = element_blank(),
    axis.text.y         = element_blank(),
    panel.grid.major.y  = element_blank(),
    axis.text.x         = element_text(angle = 45, hjust = 1)
  )
```
# Count of crimes according to top-8 locations.
```{r,warning=FALSE,message=FALSE}
# 2. Top 8 Location Types
# compute top 8 locations
top_locations <- crime %>%
  count(location_type, sort = TRUE) %>%
  slice_head(n = 8)

# plot
ggplot(top_locations, aes(
    x = fct_reorder(location_type, n),
    y = n
  )) +
  geom_col(fill = "#1B4F72") +
  geom_text(aes(label = n), 
            vjust = -0.5, 
            size = 3.5) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
  labs(
    x       = "Location Type",
    y       = NULL,
    caption = "Figure 2: Top 8 location types by frequency"
  ) +
  theme_minimal() +
  theme(
    axis.ticks.y        = element_blank(),
    axis.text.y         = element_blank(),
    panel.grid.major.y  = element_blank(),
    axis.text.x         = element_text(angle = 45, hjust = 1)
  )

```
# Crime clearance rates (2003-2013), (2014-2024)
```{r,warning=FALSE,message=FALSE}
# Compute yearly percentages of clearance_status
yearly_pct <- crime %>%
  # count per year and status
  count(occurred_date_time_year, clearance_status) %>%
  group_by(occurred_date_time_year) %>%
  mutate(
    pct = n / sum(n) * 100,
    pct_label = paste0(round(pct, 1), "%")
  ) %>%
  ungroup()

# 1. Years 2003–2013
yearly_pct %>%
  filter(between(occurred_date_time_year, 2003, 2013)) %>%
  ggplot(aes(
    x = factor(occurred_date_time_year),
    y = pct,
    fill = clearance_status
  )) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_text(aes(label = pct_label),
            position = position_dodge(width = 0.8),
            vjust = -0.3,
            size = 3) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
  labs(
    x       = "Year",
    y       = NULL,
    fill    = "Clearance Status",
    caption = "Figure 3: Clearance-status percentages by year (2003–2013)"
  ) +
  theme_minimal() +
  theme(
    axis.ticks.y       = element_blank(),
    axis.text.y        = element_blank(),
    panel.grid.major.y = element_blank(),
    axis.text.x        = element_text(angle = 45, hjust = 1)
  )

# 2. Years 2014–2024
yearly_pct %>%
  filter(between(occurred_date_time_year, 2014, 2024)) %>%
  ggplot(aes(
    x = factor(occurred_date_time_year),
    y = pct,
    fill = clearance_status
  )) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_text(aes(label = pct_label),
            position = position_dodge(width = 0.8),
            vjust = -0.3,
            size = 3) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
  labs(
    x       = "Year",
    y       = NULL,
    fill    = "Clearance Status",
    caption = "Figure 4: Clearance-status percentages by year (2014–2024)"
  ) +
  theme_minimal() +
  theme(
    axis.ticks.y       = element_blank(),
    axis.text.y        = element_blank(),
    panel.grid.major.y = element_blank(),
    axis.text.x        = element_text(angle = 45, hjust = 1)
  )

```
# Crime clearance rates according to days in a week.

```{r,warning=FALSE,message=FALSE}
library(tidyverse)

# 1. Compute percentages per day of week
day_pct <- crime %>%
  count(occurred_date_time_day_of_week, clearance_status) %>%
  group_by(occurred_date_time_day_of_week) %>%
  mutate(
    pct       = n / sum(n) * 100,
    pct_label = paste0(round(pct, 1), "%")
  ) %>%
  ungroup()

# 2. Plot
day_pct %>%
  # ensure days go Monday → Sunday
  mutate(day = fct_relevel(occurred_date_time_day_of_week,
                           "Monday","Tuesday","Wednesday",
                           "Thursday","Friday","Saturday","Sunday")) %>%
  ggplot(aes(x = day, y = pct, fill = clearance_status)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_text(aes(label = pct_label),
            position = position_dodge(width = 0.8),
            vjust = -0.3, size = 3) +
  scale_fill_manual(
    values = c("C" = "#2C3E50", "N" = "red"),
    labels = c("C" = "Cleared", "N" = "Not Cleared")
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    x       = "Day of the Week",
    y       = NULL,
    fill    = "Status",
    caption = "Figure 5: % Cleared (C) vs Not Cleared (N) by day of week"
  ) +
  theme_minimal() +
  theme(
    axis.ticks.y        = element_blank(),
    axis.text.y         = element_blank(),
    panel.grid.major.y  = element_blank(),
    panel.grid.minor.y  = element_blank(),
    axis.text.x         = element_text(angle = 45, hjust = 1)
  )

```
# Month wise crime clearance rates.

```{r,warning=FALSE,message=FALSE}
# 1. Compute month‐wise percentages
month_pct <- crime %>%
  count(occurred_date_time_month, clearance_status) %>%
  group_by(occurred_date_time_month) %>%
  mutate(
    pct       = n / sum(n) * 100,
    pct_label = paste0(round(pct, 1), "%")
  ) %>%
  ungroup()

# 2. Plot % Cleared vs Not Cleared by month
month_pct %>%
  # ensure Jan→Dec ordering
  mutate(
    month = fct_relevel(
      occurred_date_time_month,
      "January","February","March","April","May","June",
      "July","August","September","October","November","December"
    )
  ) %>%
  ggplot(aes(x = month, y = pct, fill = clearance_status)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_text(aes(label = pct_label),
            position = position_dodge(width = 0.8),
            vjust = -0.3,
            size = 3) +
  scale_fill_manual(
    values = c("C" = "#E69F00", "N" = "#56B4E9"),    # color‐blind friendly
    labels = c("C" = "Cleared", "N" = "Not Cleared")
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    x       = "Month",
    y       = NULL,
    fill    = "Status",
    caption = "Figure 6: % Cleared (C) vs Not Cleared (N) by month"
  ) +
  theme_minimal() +
  theme(
    axis.ticks.y        = element_blank(),
    axis.text.y         = element_blank(),
    panel.grid.major.y  = element_blank(),
    panel.grid.minor.y  = element_blank(),
    axis.text.x         = element_text(angle = 45, hjust = 1)
  )

```
# Family Violence's influence in crime clearance rates
```{r,warning=FALSE,message=FALSE}
library(tidyverse)

# 1. Compute percentages by family_violence & clearance_status
family_pct <- crime %>%
  count(family_violence, clearance_status) %>%
  group_by(family_violence) %>%
  mutate(
    pct       = n / sum(n) * 100,
    pct_label = paste0(round(pct, 1), "%")
  ) %>%
  ungroup()

# 2. Plot % Cleared vs Not Cleared by Family Violence
ggplot(family_pct, aes(
    x    = family_violence,
    y    = pct,
    fill = clearance_status
  )) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_text(aes(label = pct_label),
            position = position_dodge(width = 0.8),
            vjust = -0.3,
            size = 3) +
  scale_fill_manual(
    values = c("C" = "#332288", "N" = "#DDCC77"),  # color‐blind friendly
    labels = c("C" = "Cleared",    "N" = "Not Cleared")
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    x       = "Family Violence",
    y       = NULL,
    fill    = "Status",
    caption = "Figure 7: Percentage of crimes Cleared (C) vs Not Cleared (N), grouped by Family Violence (Y/N)"
  ) +
  theme_minimal() +
  theme(
    axis.ticks.y        = element_blank(),
    axis.text.y         = element_blank(),
    panel.grid.major.y  = element_blank(),
    panel.grid.minor.y  = element_blank()
  )

```
# Influence of Spatial locations in crime clearing.

```{r,warning=FALSE,message=FALSE}
# 1. Total crime count by APD Sector
sector_count <- crime %>%
  count(apd_sector, sort = TRUE)

ggplot(sector_count, aes(
    x = fct_reorder(apd_sector, n),
    y = n
  )) +
  geom_col(fill = "#009E73") +                                  # color‐blind friendly green
  geom_text(aes(label = n), 
            vjust = -0.5, 
            size = 3) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
  labs(
    x       = "APD Sector",
    y       = NULL,
    caption = "Figure 8: Total crime count by APD Sector"
  ) +
  theme_minimal() +
  theme(
    axis.ticks.y        = element_blank(),
    axis.text.y         = element_blank(),
    panel.grid.major.y  = element_blank(),
    axis.text.x         = element_text(angle = 45, hjust = 1)
  )


# 2. Percentage Cleared vs Not Cleared by APD Sector
sector_pct <- crime %>%
  count(apd_sector, clearance_status) %>%
  left_join(sector_count, by = "apd_sector", suffix = c("", ".total")) %>%
  group_by(apd_sector) %>%
  mutate(
    pct       = n / n.total * 100,
    pct_label = paste0(round(pct, 1), "%")
  ) %>%
  ungroup() %>%
  # keep same sector ordering as the count plot
  mutate(apd_sector = factor(apd_sector, levels = sector_count$apd_sector))

ggplot(sector_pct, aes(
    x = apd_sector,
    y = pct,
    fill = clearance_status
  )) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_text(aes(label = pct_label),
            position = position_dodge(width = 0.8),
            vjust = -0.3,
            size = 3) +
  scale_fill_manual(
    values = c("C" = "#117733", "N" = "#CC6677"),                # color‐blind friendly orange & blue
    labels = c("C" = "Cleared",  "N" = "Not Cleared")
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(
    x       = "APD Sector",
    y       = NULL,
    fill    = "Status",
    caption = "Figure 9: Percentage of crimes Cleared (C) vs Not Cleared (N) by APD Sector"
  ) +
  theme_minimal() +
  theme(
    axis.ticks.y        = element_blank(),
    axis.text.y         = element_blank(),
    panel.grid.major.y  = element_blank(),
    axis.text.x         = element_text(angle = 45, hjust = 1)
  )

```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```

```{r,warning=FALSE,message=FALSE}
```






